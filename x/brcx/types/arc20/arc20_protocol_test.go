package arc20

import (
	"encoding/hex"
	"github.com/ethereum/go-ethereum/common"
	"github.com/stretchr/testify/require"
	"reflect"
	"testing"
)

func TestUnpackArc20EventContext(t *testing.T) {
	topics, err := hex.DecodeString("77d883ed9330f3dc9b41191c369bde04a1e24acedb17b4c00ade27ec1586254d")
	require.NoError(t, err)
	event, err := arc20EntryPointABI.EventByID(common.BytesToHash(topics))
	require.NoError(t, err)

	t.Log("event name", event.Name)
	logs, err := hex.DecodeString("00000000000000000000000000000000000000000000000000000000000000201d2f39f54320631d0432fa495a45a4f298a2ca1b18adef8e4356e327d003a694000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000260000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000002a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002c000000000000000000000000000000000000000000000000000000000000002e00000000000000000000000000000000000000000000000000000000000000042353661383730326261623364323430356562396133353666643037323563613131326139336138656664316563636130366336303835653732373866303334316930000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001261746f6d6963616c2d6372656174652d66740000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d646563656e7472616c697a6564000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000461746f6d00000000000000000000000000000000000000000000000000000000")
	require.NoError(t, err)
	hehe, err := event.Inputs.Unpack(logs)
	require.NoError(t, err)

	for i := range hehe {
		hehe_type := reflect.TypeOf(hehe[i]) //为类型
		hehe_value := reflect.ValueOf(hehe[i])
		t.Log("type:", hehe_type, "value", hehe_value)

	}

	events, err := UnpackArc20EventContext(logs, common.BytesToHash(topics))
	require.NoError(t, err)
	t.Log(events)
}
